---
layout: page
title: 每日学习笔记
permalink: /notebook/
---

> 每日的学习笔记，主要用来发布前一天学习的所有理论知识，即每天早上8点30之后可以随时在这里看到之前的一天学习的内容有哪些，也可以看[提交记录](https://github.com/GadHao/gadhao.github.io/commits/master)追溯之前提交过的内容

## 总结[2020.09.12]

## 《深入了解计算机系统》的学习(Page7- Page12)

从系统通电到断电，处理器一直在不断执行程序计数器指向的指令，并更新计数器，使其指向下一条指令

   处理器按照一个非常简单的指令模型来操作，这个模型由*指令集架构*决定。在这个模型中，指令按照严格的顺序执行，而每条的执行又包含一定的步骤。

   处理器从程序计数器指向的内存读取指令，解释指令中的位，执行该指令指示的简单操作，然后更新PC，使其指向下一条指令，这条指令和在内存中刚刚执行的指令不一定是相邻的

这些操作围绕着主存、寄存器文件(register file)和算数/逻辑单元(ALU)进行。寄存器文件是一个小的存储设备，由一些单个字长的寄存器[^5]组成，每个寄存器都有唯一的名字。ALU计算新的数据和地址值，CPU在指令的要求下可能会执行的操作有：

- **加载**：从主存赋值一个字节或者一个字到寄存器，以覆盖寄存器原来的内存
- **存储**：从寄存器赋值一个字节或者一个字到主存的某个位置，覆盖掉这个位置原来的内容
- **操作**：把两个寄存器的内容赋值到ALU，ALU对这两个字做算数运算，并将结果放到一个寄存器中，覆盖该寄存器中原来的内容
- **跳转**：从指令本身中抽取一个字，并将这个字赋值到程序计数器(PC)，覆盖PC中原来的值

  看上去处理器简单实现了它的指令集架构，但是实际上现代处理器为了加速程序执行，使用了非常复杂的机制。所以我们这里把指令集架构和处理器的为体系结构区分讨论，指令集架构描述的是每条机器代码指令的效果，具有一定的抽象性。而微体系结构描述的是实际上是如何实现的。

#### 运行hello程序

首先我们在键盘上输入字符串`./hello`时，shell程序将字符逐一读入寄存器，再把它放到内存中

![](/assets/img/CSAPP-3.JPG)

当在键盘上敲回车键时，shell程序知道了我们已经结束了指令的输入，于是其加载可执行的hello文件，这些指令将hello目标文件的代码和数据(包括最后会被输出的字符串"hello, world\n")从磁盘复制到主存

利用直接存储器存取(DMA，书本后面会讨论)技术，数据可以不通过处理器而直接从磁盘到达主存

![](/assets/img/CSAPP-4.JPG)

当目标文件hello中的代码和数据被加载到主存后，处理器就开始执行hello程序的main程序中的机器语言指令。这些指令将"hello, world\n"字符串中的字节从主存复制到寄存器文件，再从寄存器文件复制到显示设备，最后显示在屏幕上

![](/assets/img/CSAPP-5.JPG)

### 高速缓存的重要性

从这个示例可以看出，系统花费了大量的时间把信息从一个地方挪到另一个地方。这些复制作为开销，减慢了程序"真正"的工作。因此系统设计者的一个主要目标是让这些复制操作尽快完成

根据机械原理，较大的存储设备比较小的存储设备运行得慢，对处理器而言，从磁盘驱动器上读取一个字的时间开销要比从主存中读取的开销大1000万倍，从寄存器文件中读数据比主存中读取几乎要快100倍，而且这个差距随着半导体技术的进步还在持续增大

针对这种处理器与主存之间的差异，系统设计这使用了更小更快的*高速缓存存储器(cache memory，简称为cache或高速缓存)*作为暂时的集结区域，存放处理器近期可能会需要的信息。一个典型系统中通常有位于处理器芯片上的*L1高速缓存器*，容量可以达到数万字节，访问速度几乎和访问寄存器一样快。L2缓存器通过一条特殊的总线连接到处理器。高速缓存是用一种叫做**静态随机访问存储器(SRAM)**的硬件技术实现的。比较新，处理能力更强大的系统还可能有三级高速缓存，L1，L2和L3。利用高速缓存的**局部性**原理，即程序具有访问局部区域里的数据和代码的趋势，系统可以获得一个很大的存储器，同时访问速度也很快。

![](/assets/img/CSAPP-6.JPG)



### 存储设备形成层次结构

在处理器和一个较大较慢的设备(如内存)之间插入一个更小更快的存储设备(如高速缓存)的想法已经成为一个普遍的观念。每个计算机中的存储设备被组织成一个**存储器层次结构**，在这个层次结构中，从上到下，设备的访问速度越来越慢、容量越来越大，每字节的造价也越来越便宜

![](/assets/img/CSAPP-7.JPG)

存储器的层次结构的主要思想是上一层的存储器作为低一层存储器的高速缓存。在某些具有分布式文件系统的网络系统中，本地磁盘就是存储在其他系统中磁盘上的数据的高速缓存

利用对整个存储器层次结构的理解，可以提高程序性能。本书后面会更详细讨论这个问题

### 操作系统管理硬件

当shell加载和运行`hello`程序，以及`hello`程序输出自己的消息时，shell和`hello`程序都没有直接访问键盘、显示器或者主存。它们依靠操作系统提供的服务来完成这个过程。可以把操作系统看作是应用程序和硬件之间的一层软件，所有应用对硬件的操作尝试都必须通过操作系统，操作系统有两个基本功能：

1. 防止硬件被时空的应用程序滥用；
2. 向应用程序提供简单一致的机制来控制复杂而又通常大不相同的低级硬件设备。通过几个基本的抽象概念(进程、虚拟内存和文件)来实现这两个功能。

![](/assets/img/CSAPP-8.JPG)



#### 进程

当`hello`程序运行时，操作系统会提供一种假象，好像系统上只有这个程序在运行(在linux系统中，界面上只能观察到这个程序在运行)。就好像它独占了所有的硬件设备，处理器在不间断地执行程序中的指令，而该程序的代码和数据是系统内存中唯一的对象。这种现象是通过进程的概念来实现的。

<br/><br/><br/><br/><br/><br/>


[^4]: 控制器和适配器之间区别主要在于它们的封装方式。控制器是I/O设备本身或者系统的主印刷电路板(主板)上的芯片组。而适配器则是一块插在主板上的卡。无论如何，它们的功能都是在I/O总线和I/O设备之间传递信息
[^5]: 这里的寄存器要和前面提到的PC不是同一种东西，这里的寄存器是实实在在的寄存器。首先要明确，PC可以是实实在在的寄存器，也可以不是一个寄存器，书里提到这个概念只是想让人们明白在CPU体系里有一个用来存放指令地址的东西，在不同的指令集架构(x86，x64等)里面，它的称呼或者说法也可能不一样。这里不需要用太严格的理论来套实际的设计	