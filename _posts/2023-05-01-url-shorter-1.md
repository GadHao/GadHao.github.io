---
layout: post
title: '实现一个短链服务器'
date: 2022-05-01
author: HANABI
tags: 短链
category: [经验技巧, 经验总结]
---

> 短链服务器，即将长链接转换为短链接的服务器，本文记录实现一个短链服务器的过程。

## 背景

将长链接转换成短链接有几个显而易见的好处：
1. 方便记忆
2. 便于分享
3. 降低二维码的复杂度

以及一些其他用途，例如可以基于短链服务器做一些流量统计，增加链接过期等功能。

## 构思

实现短链的转换，存储及跳转是非常容易的，但是在实际实现过程中，还是有一些需要考虑的问题：

### 短链编码生成方式的选择

短链编码，即短链中唯一变化的部分。可选的方式不止一种，但是有一个共同点，就是如果生成了一个10进制的数字，则可以将其进行进一步进行base62编码，因为base62可以使用包括数字，小写字母，大写字母在内的62个字符，可以进一步缩短短链的长度。

**1. 自增ID**

使用各种方式（程序内存内自增，数据库自增，Redis自增等）生成一个自增的ID，然后将这个ID转换为62进制的字符串作为短链的编码。这种处理方式的好处是因为基于现有的自增逻辑，只要能够保证自增机制的可靠以及唯一性，就可以保证短链的生成无碰撞。

但是这种方案的缺点也很明显，首先这样生成的编码是有序的，可以很容易的被其他人遍历到所有的短链；其次，生成的短链和原长链接本身不具有任何关联性，这意味着如果希望不生成重复的短链，就需要在每次生成短链之前，用当前这个长链接查询是否已经存在短链，考虑到原链接可能会非常长，这样产生的查询开销显然是不低的；另外，如果借助的是数据库主键自增的方式，数据库逐渐自增的速率也可能会成为瓶颈。

**2. 随机数**

直接在程序内使用普通随机数作为短链编码，然后将其转换为62进制的字符串。这种方式的好处是生成的短链是无序的，不容易被遍历到所有的短链。缺点是随机数的生成本身是有碰撞的，在生成速度比较快的情况下，这个碰撞的几率可能会非常大，这样一来，可能需要重复几次随机过程才能生成一个新的短链，另外如果希望不重复，和自增ID的方式一样，也需要在生成短链之前，用当前这个长链接查询是否已经存在短链。