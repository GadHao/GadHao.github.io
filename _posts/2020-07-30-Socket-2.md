---
layout: post
title: '制作一个基于.NET的WebApi服务映射工具(2) - 使用Socket创建一个可以响应HTTP请求的服务器端'
date: 2020-07-30
author: HANABI
color: rgb(59,46,42)
tags: Socket
---

> 前面了解了TCP协议，现在让我们来关注Socket

## Socket是什么

### 概念浅析

Socket直译成“孔”或“插座”，作为进程之间的一种通信机制，通常也被称为“套接字”，是用于描述IP地址和端口号的通信链的句柄。

要满足套接字这个概念，必须给出四个元组，一端的Ip+port 和另一端的ip+port，是在整个互联网中唯一表示的，唯一表示互联网中两个程序之间的通信 ，操作系统可以分配的最大的端口号是65535

问：当一台服务器已经和另一台服务器建立了65536个(0号端口也能用)连接之后，还能不能和其它服务器建立连接

答：能，因为连往的IP是不同的，还是能唯一表示不同的通信

问：如果服务器就一台，另一台物理服务器要对其进行一个压力测试，测试其并发数，要怎么做

答：使用虚拟IP，不断用不同的IP去与其建立连接

通俗的讲，人与人之间可以通过打电话来进行通信，程序与程序之间要进行通信，互相收发数据，就需要通过Socket来通信，所以不难理解为什么需要描述IP地址和端口号，把电话区号当作IP地址，后面的部分当作端口号，这样构成的一个完整的 电话号码，才能和确切的某一个人进行通话

> 在这个过程中，协议可以理解成打电话时双方沟通时用的语言，这篇里简单了解，TCP协议是面向连接的，是流式(STREAM)的，每次传输都需要建立三次握手，确保通信过程不会出现数据丢失
>
> UDP协议是无连接的，是数据报式(DATAGRAM)的，不安全(丢失，顺序混乱，在接收端要分析重排及要求重发)，但效率高，在传输视频的时候通常使用UDP

其实这里的知识，在了解TCP的时候已经有很多可以体会到了，比如为什么必须有四元组，为什么TCP是面向连接的可靠的传输协议，不过因为是先写了一部分这篇，才去写第一篇关于TCP的知识，所以这一部分还是留下来了，不想太过于深究TCP知识，直接看这里也可以

## 开始编程

本来还想详细介绍C# Socket编程中用到的各种类，函数的相应用法和描述，以及使用时对应TCP通信的各阶段的，但是抓了一下包之后感觉没有什么特别值得在意的，之后直接上代码就好了，这里主要介绍一些针对这次要用Socket做的事情，需要了解哪些特别的东西

首先，我们今天要编写的工具是需要返回HTTP请求，其它的格式都不返回，所以我们首先要了解HTTP请求的格式

![](/assets/img/socket-5.jpg)

所以，一个完整的HTTP请求大概这样子：

```
GET /getdata HTTP/1.1
User-Agent: PostmanRuntime/7.26.2
Accept: */*
Postman-Token: e9544775-bb73-401c-b618-3bd573816837
Host: 192.168.31.236:100
Accept-Encoding: gzip, deflate, br
Connection: keep-alive
Content-Type: application/x-www-form-urlencoded
Content-Length: 1230
```

